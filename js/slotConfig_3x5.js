var slotConfig_3x5 = {
    symbolSizeY: 263,
    spinTime: 2000,
    winShowTime: 3000,
    showWinCoinsMessage: false,
    winMessageTime: 2400,
    minWin: 200,
    useBigWinCongratulation: true,
    showWinFreeSpinsMessage: true,
    showFreeGameMessage: true,
    symbAnimFrameRate: 24,
    frameWidth: 224,
    frameHeight: 240,
    playSpinSound: false,
    lineColor: 0xFFEA31,
    showWinLines: true,
    lineBetMaxValue: 20,
    useWild: true,
    wild: 'Wild',
    useScatter: true,
    scatter: 'Scatter',
    selectedLines: 'all',
    useWildInFirstPosition: false,
    useLineBetMultiplier: true,
    useLineBetFreeSpinMultiplier: false,
    defaultCoins: 100000,
    localOffsetX: 0,
    localOffsetY: 0,
    maxHold: 2,
    fonts: [{
        fontName: 'gameFont_0',
        filePNG: 'fonts/CorbenB_36_0.png',
        fileXML: 'fonts/CorbenB_36_0.xml'
    }, {
        fontName: 'gameFont_1',
        filePNG: 'fonts/CorbenR_36_1.png',
        fileXML: 'fonts/CorbenR_36_1.xml'
    }, {
        fontName: 'gameFont_2',
        filePNG: 'fonts/CorbenB_36_2.png',
        fileXML: 'fonts/CorbenB_36_2.xml'
    }, {
        fontName: 'gameFont_3',
        filePNG: 'fonts/CorbenB_36_3.png',
        fileXML: 'fonts/CorbenB_36_3.xml'
    }, ],
    sprites: [{
        fileName: 'debug.png',
        name: 'debugreference'
    }, {
        fileName: 'SlotMachine_3x5.png',
        name: 'slot'
    }, {
        fileName: null,
        name: 'bottom_panel'
    }, {
        fileName: null,
        name: 'top_panel'
    }, {
        fileName: 'PanelJackpot.png',
        name: 'paneljackpot'
    }, {
        fileName: 'ButtonPlus.png',
        name: 'button_plus'
    }, {
        fileName: 'ButtonPlusHover.png',
        name: 'button_plus_hover'
    }, {
        fileName: 'ButtonMinus.png',
        name: 'button_minus'
    }, {
        fileName: 'ButtonMinusHover.png',
        name: 'button_minus_hover'
    }, {
        fileName: 'PanelTotalBet.png',
        name: 'panel_totalbet'
    }, {
        fileName: null,
        name: 'panel_linebet'
    }, {
        fileName: 'PanelWin.png',
        name: 'panel_win'
    }, {
        fileName: 'PanelLines.png',
        name: 'panel_lines'
    }, {
        fileName: 'PanelBalance.png',
        name: 'panel_balance'
    }, {
        fileName: null,
        name: 'panel_menu'
    }, {
        fileName: null,
        name: 'button_line'
    }, {
        fileName: null,
        name: 'button_line_hover'
    }, {
        fileName: 'ButtonMaxBet.png',
        name: 'button_maxbet'
    }, {
        fileName: 'ButtonMaxBetHover.png',
        name: 'button_maxbet_hover'
    }, {
        fileName: 'ButtonSpin.png',
        name: 'button_spin'
    }, {
        fileName: 'ButtonSpinHover.png',
        name: 'button_spin_hover'
    }, {
        fileName: 'ButtonAutoSpin.png',
        name: 'button_autospin'
    }, {
        fileName: 'ButtonAutoSpinHover.png',
        name: 'button_autospin_hover'
    }, {
        fileName: null,
        name: 'button_hold'
    }, {
        fileName: null,
        name: 'button_hold_on'
    }, {
        fileName: null,
        name: 'progress_base'
    }, {
        fileName: null,
        name: 'progress_fill'
    }, {
        fileName: null,
        name: 'progress_spot'
    }, {
        fileName: 'LanternSpot.png',
        name: 'lantern_spot'
    }, {
        fileName: 'ButtonMenu.png',
        name: 'button_menu'
    }, {
        fileName: 'ButtonMenuHover.png',
        name: 'button_menu_hover'
    }, {
        fileName: 'ButtonInfo.png',
        name: 'button_info'
    }, {
        fileName: 'ButtonInfoHover.png',
        name: 'button_info_hover'
    }, {
        fileName: 'ButtonSettings.png',
        name: 'button_settings'
    }, {
        fileName: 'ButtonSettingsHover.png',
        name: 'button_settings_hover'
    }, {
        fileName: 'ButtonRules.png',
        name: 'button_rules'
    }, {
        fileName: 'ButtonRulesHover.png',
        name: 'button_rules_hover'
    }, {
        fileName: 'gui/ButtonOn.png',
        name: 'button_on'
    }, {
        fileName: 'gui/ButtonOff.png',
        name: 'button_off'
    }, {
        fileName: 'gui/MessagePanel.png',
        name: 'message_panel'
    }, {
        fileName: 'gui/SmallMessagePanel.png',
        name: 'small_message_panel'
    }, {
        fileName: 'gui/AboutPanel.png',
        name: 'about_panel'
    }, {
        fileName: 'gui/SettingsPanel.png',
        name: 'settings_panel'
    }, {
        fileName: 'gui/FreeSpinPanel.png',
        name: 'freespin_panel'
    }, {
        fileName: null,
        name: 'bigwin_panel'
    }, {
        fileName: 'gui/HugeWinPanel.png',
        name: 'hugewin_panel'
    }, {
        fileName: 'gui/MegaWinPanel.png',
        name: 'megawin_panel'
    }, {
        fileName: null,
        name: 'settings_title'
    }, {
        fileName: 'gui/PayLinesTable.png',
        name: 'paylines_table'
    }, {
        fileName: null,
        name: 'minor_title'
    }, {
        fileName: null,
        name: 'major_title'
    }, {
        fileName: null,
        name: 'rules_title'
    }, {
        fileName: null,
        name: 'special_title'
    }, {
        fileName: null,
        name: 'paylines_title'
    }, {
        fileName: null,
        name: 'symbol_plate'
    }, {
        fileName: null,
        name: 'specsymbol_plate'
    }, {
        fileName: 'gui/Logo.png',
        name: 'logo'
    }, {
        fileName: 'gui/ExitButton.png',
        name: 'exit_button'
    }, {
        fileName: 'gui/ExitButtonHover.png',
        name: 'exit_button_hover'
    }, {
        fileName: null,
        name: 'middle_button'
    }, {
        fileName: null,
        name: 'middle_button_hover'
    }, {
        fileName: 'gui/LongButton.png',
        name: 'long_button'
    }, {
        fileName: 'gui/LongButtonHover.png',
        name: 'long_button_hover'
    }, {
        fileName: 'gui/ExtraLongButton.png',
        name: 'extralong_button'
    }, {
        fileName: 'gui/ExtraLongButtonHover.png',
        name: 'extralong_button_hover'
    }, {
        fileName: 'gui/SmallButton.png',
        name: 'small_button'
    }, {
        fileName: 'gui/SmallButtonHover.png',
        name: 'small_button_hover'
    }, {
        fileName: 'gui/InfoPanel.png',
        name: 'info_panel'
    }, {
        fileName: null,
        name: 'help_title'
    }, {
        fileName: 'gui/JackpotWinPanel.png',
        name: 'jackpotwin_panel'
    }, {
        fileName: null,
        name: 'jackpotwin_title'
    }, {
        fileName: null,
        name: 'pu_background'
    }, {
        fileName: 'gui/grayBkg_01.png',
        name: 'gray_01'
    }, {
        fileName: 'gui/whiteBkg.png',
        name: 'white_bkg'
    }, {
        fileName: 'gui/NextButtonHover.png',
        name: 'next_button_hover'
    }, {
        fileName: 'gui/NextButton.png',
        name: 'next_button'
    }, {
        fileName: 'gui/PrevButtonHover.png',
        name: 'prev_button_hover'
    }, {
        fileName: 'gui/PrevButton.png',
        name: 'prev_button'
    }, {
        fileName: null,
        name: 'soundon'
    }, {
        fileName: null,
        name: 'soundoff'
    }, {
        fileName: null,
        name: 'musicon'
    }, {
        fileName: null,
        name: 'musicoff'
    }, {
        fileName: null,
        name: 'navi_dot'
    }, {
        fileName: null,
        name: 'navi_dot_active'
    }, {
        fileName: null,
        name: 'lamp_off'
    }, {
        fileName: null,
        name: 'lamp_on'
    }, ],
    symbols: [{
        fileName: 'BlueBottle.png',
        name: 'BlueBottle',
        fileNameBlurred: 'BlueBottleBlurred.png',
        animation: 'BlueBottleSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'GreenBottle.png',
        name: 'GreenBottle',
        fileNameBlurred: 'GreenBottleBlurred.png',
        animation: 'GreenBottleSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'VioletBottle.png',
        name: 'VioletBottle',
        fileNameBlurred: 'VioletBottleBlurred.png',
        animation: 'VioletBottleSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'MargenteBottle.png',
        name: 'MargenteBottle',
        fileNameBlurred: 'MargenteBottleBlurred.png',
        animation: 'MargenteBottleSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'Hat.png',
        name: 'Hat',
        fileNameBlurred: 'HatBlurred.png',
        animation: 'HatSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'Candles.png',
        name: 'Candles',
        fileNameBlurred: 'CandlesBlurred.png',
        animation: 'CandlesSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'Scroll.png',
        name: 'Scroll',
        fileNameBlurred: 'ScrollBlurred.png',
        animation: 'ScrollSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'Broom.png',
        name: 'Broom',
        fileNameBlurred: 'BroomBlurred.png',
        animation: 'BroomSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: true
    }, {
        fileName: 'Wild.png',
        name: 'Wild',
        fileNameBlurred: 'WildBlurred.png',
        animation: 'WildSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: false
    }, {
        fileName: 'Scatter.png',
        name: 'Scatter',
        fileNameBlurred: 'ScatterBlurred.png',
        animation: 'ScatterSheet.png',
        hideWinSymbol: true,
        useWildSubstitute: false
    }, ],
    reels: [{
        symbolImages: ['MargenteBottle', 'VioletBottle', 'Candles', 'Hat', 'Broom', 'BlueBottle', 'GreenBottle', 'Scroll', 'Hat', 'Broom'],
        offsetX: -454,
        offsetY: -42,
        windowImage: 'reel',
        windowsCount: 3,
        addSpinTime: 0,
    }, {
        symbolImages: ['VioletBottle', 'BlueBottle', 'Wild', 'MargenteBottle', 'Broom', 'Broom', 'Candles', 'Hat', 'Scroll', 'Hat', 'GreenBottle', 'Broom', 'Wild', 'Hat'],
        offsetX: -227,
        offsetY: -42,
        windowImage: 'reel',
        windowsCount: 3,
        addSpinTime: 100,
    }, {
        symbolImages: ['VioletBottle', 'Wild', 'Scroll', 'MargenteBottle', 'Broom', 'BlueBottle', 'Broom', 'Candles', 'Wild', 'Scatter', 'Wild', 'Hat', 'GreenBottle', 'Hat'],
        offsetX: 0,
        offsetY: -42,
        windowImage: 'reel',
        windowsCount: 3,
        addSpinTime: 200,
    }, {
        symbolImages: ['MargenteBottle', 'VioletBottle', 'Wild', 'Candles', 'Broom', 'VioletBottle', 'Scroll', 'Wild', 'Hat', 'Wild', 'Scatter', 'BlueBottle', 'Scatter', 'GreenBottle'],
        offsetX: 227,
        offsetY: -42,
        windowImage: 'reel',
        windowsCount: 3,
        addSpinTime: 300,
    }, {
        symbolImages: ['BlueBottle', 'Wild', 'VioletBottle', 'MargenteBottle', 'VioletBottle', 'Candles', 'Wild', 'Broom', 'Wild', 'Hat', 'Scatter', 'Scroll', 'Scatter', 'GreenBottle'],
        offsetX: 454,
        offsetY: -42,
        windowImage: 'reel',
        windowsCount: 3,
        addSpinTime: 400,
    }],
    lines: [
        [1, 1, 1, 1, 1],
        [2, 2, 2, 2, 2],
        [0, 0, 0, 0, 0],
        [2, 1, 0, 1, 2],
        [0, 1, 2, 1, 0],
        [1, 2, 1, 2, 1],
        [1, 0, 1, 0, 1],
        [2, 2, 1, 0, 0],
        [0, 0, 1, 2, 2],
        [1, 0, 1, 2, 1],
        [1, 2, 1, 0, 1],
        [2, 1, 1, 1, 2],
        [0, 1, 1, 1, 0],
        [2, 1, 2, 1, 2],
        [0, 1, 0, 1, 0],
        [1, 1, 2, 1, 1],
        [1, 1, 0, 1, 1],
        [2, 2, 0, 2, 2],
        [0, 0, 2, 0, 0],
        [2, 0, 0, 0, 2],
    ],
    payLines: [{
        line: ['BlueBottle', 'BlueBottle', 'BlueBottle', 'BlueBottle', 'BlueBottle'],
        pay: 3,
        freeSpins: 0
    }, {
        line: ['BlueBottle', 'BlueBottle', 'BlueBottle', 'BlueBottle', 'any'],
        pay: 2,
        freeSpins: 0
    }, {
        line: ['BlueBottle', 'BlueBottle', 'BlueBottle', 'any', 'any'],
        pay: 1,
        freeSpins: 0
    }, {
        line: ['GreenBottle', 'GreenBottle', 'GreenBottle', 'GreenBottle', 'GreenBottle'],
        pay: 5,
        freeSpins: 0
    }, {
        line: ['GreenBottle', 'GreenBottle', 'GreenBottle', 'GreenBottle', 'any'],
        pay: 3,
        freeSpins: 0
    }, {
        line: ['GreenBottle', 'GreenBottle', 'GreenBottle', 'any', 'any'],
        pay: 1,
        freeSpins: 0
    }, {
        line: ['MargenteBottle', 'MargenteBottle', 'MargenteBottle', 'MargenteBottle', 'MargenteBottle'],
        pay: 6,
        freeSpins: 0
    }, {
        line: ['MargenteBottle', 'MargenteBottle', 'MargenteBottle', 'MargenteBottle', 'any'],
        pay: 3,
        freeSpins: 0
    }, {
        line: ['MargenteBottle', 'MargenteBottle', 'MargenteBottle', 'any', 'any'],
        pay: 2,
        freeSpins: 0
    }, {
        line: ['VioletBottle', 'VioletBottle', 'VioletBottle', 'VioletBottle', 'VioletBottle'],
        pay: 7,
        freeSpins: 0
    }, {
        line: ['VioletBottle', 'VioletBottle', 'VioletBottle', 'VioletBottle', 'any'],
        pay: 3,
        freeSpins: 0
    }, {
        line: ['VioletBottle', 'VioletBottle', 'VioletBottle', 'any', 'any'],
        pay: 2,
        freeSpins: 0
    }, {
        line: ['Candles', 'Candles', 'Candles', 'Candles', 'Candles'],
        pay: 17,
        freeSpins: 0
    }, {
        line: ['Candles', 'Candles', 'Candles', 'Candles', 'any'],
        pay: 13,
        freeSpins: 0
    }, {
        line: ['Candles', 'Candles', 'Candles', 'any', 'any'],
        pay: 11,
        freeSpins: 0
    }, {
        line: ['Broom', 'Broom', 'Broom', 'Broom', 'Broom'],
        pay: 19,
        freeSpins: 0
    }, {
        line: ['Broom', 'Broom', 'Broom', 'Broom', 'any'],
        pay: 13,
        freeSpins: 0
    }, {
        line: ['Broom', 'Broom', 'Broom', 'any', 'any'],
        pay: 11,
        freeSpins: 0
    }, {
        line: ['Scroll', 'Scroll', 'Scroll', 'Scroll', 'Scroll'],
        pay: 20,
        freeSpins: 0
    }, {
        line: ['Scroll', 'Scroll', 'Scroll', 'Scroll', 'any'],
        pay: 14,
        freeSpins: 0
    }, {
        line: ['Scroll', 'Scroll', 'Scroll', 'any', 'any'],
        pay: 11,
        freeSpins: 0
    }, {
        line: ['Hat', 'Hat', 'Hat', 'Hat', 'Hat'],
        pay: 25,
        freeSpins: 0
    }, {
        line: ['Hat', 'Hat', 'Hat', 'Hat', 'any'],
        pay: 15,
        freeSpins: 0
    }, {
        line: ['Hat', 'Hat', 'Hat', 'any', 'any'],
        pay: 11,
        freeSpins: 0
    }, ],
    scatterPayTable: [{
        scattersCount: 3,
        pay: 0,
        freeSpins: 1,
        winEventString: null
    }, {
        scattersCount: 4,
        pay: 0,
        freeSpins: 2,
        winEventString: null
    }, {
        scattersCount: 5,
        pay: 0,
        freeSpins: 5,
        winEventString: null
    }],
    jackpot: {
        symbolName: 'Wild',
        symbolsCount: 7,
        defaultAmount: 1000,
        increaseValue: 1,
    },
    createSlotGraphic: function(scene) {
        scene.debugreference = scene.addSpriteLocPos('debugreference', 0, 0);
        scene.debugreference.depth = 2000;
        scene.debugreference.setAlpha(0.0);
        scene.slot = scene.addSpriteLocPos('slot', 0, -82);
        scene.slot.depth = -1;
        scene.paneljackpot = scene.addSpriteLocPos('paneljackpot', 0, -489);
        scene.paneljackpot.setDepth(12)
    },
    createReels: function(scene) {
        var _reels = [];
        for (var ri = 0; ri < this.reels.length; ri++) {
            _reels.push(new Reel(scene, this.reels[ri], ri, this.symbolSizeY, this.reels[ri].windowsCount, true, this.spinTime, this.symbAnimFrameRate));
            _reels[ri].scaleMaskAndOffset(1, 0.965, 0, 20)
        }
        return _reels
    },
    lineButtonsLeftOrder: [4, 2, 8, 10, 6, 1, 7, 9, 3, 5],
    lineButtonsRightOrder: [14, 20, 12, 18, 16, 11, 17, 13, 15, 19],
    createControls: function(scene, slotControls) {
        let depth = 11;
        slotControlsTmp = slotControls;

        slotControls.spinTextString = 'SPIN';
        slotControls.helpTextString = 'HELP';

        function addSprite(spriteName, posX, posY, _depth) {
            var _sprite = scene.addSpriteLocPos(spriteName, posX, posY);
            _sprite.setDepth(_depth);
            return _sprite
        }

        function addButton(spriteNormal, spriteHover, isSwitch, posX, posY, originX, originY, _depth) {
            var _button = new SceneButton(scene, spriteNormal, spriteHover, isSwitch);
            slotControls.buttons.push(_button);
            _button.create(posX, posY, originX, originY, );
            _button.setDepth(_depth);
            return _button
        }
        slotControls.linesPanel = addSprite('panel_lines', -580, 470, depth);
        slotControls.totalbetPanel = addSprite('panel_totalbet', -340, 470, depth);
        slotControls.balancePanel = addSprite('panel_balance', 340, 470, depth);
        slotControls.winPanel = addSprite('panel_win', 580, 470, depth);
        slotControls.slotMaxBetButton = addButton('button_maxbet', 'button_maxbet_hover', false, -98, 470, 0.5, 0.5, depth);
        slotControls.slotMaxBetButton.addClickEvent(slotControls.maxBet_Click, slotControls);
        slotControls.slotAutoSpinButton = addButton('button_autospin', 'button_autospin_hover', true, 98, 470, 0.5, 0.5, depth);
        slotControls.slotAutoSpinButton.button.setVisible(true);
        slotControls.changeAutoSpinModeEvent.add((autoSpin) => {
            if (!autoSpin) {
                slotControls.slotAutoSpinButton.release()
            }
        }, this);
        slotControls.slotSpinButton = new SpinButton(scene, 'button_spin', 'button_spin_hover', false);
        slotControls.buttons.push(slotControls.slotSpinButton);
        slotControls.slotSpinButton.create(2, 438, 0.5, 0.5);
        slotControls.slotSpinButton.clickEvent.add(scene.handleAnimation, scene);
        slotControls.slotSpinButton.setDepth(depth);
        slotControls.menuButton = addButton('button_menu', 'button_menu_hover', true, -815, 470, 0.5, 0.5, depth);
        slotControls.menuButton.addClickEvent(() => {
            console.log('menu click');
            
            var pu = scene.guiController.showPopUp(this.createInfoPUHandler);
            scene.soundController.playClip('button_click')
        }, this);
        slotControls.menuButton.button.setVisible(true);
        slotControls.settingsButton = addButton('button_settings', 'button_settings_hover', false, -815, 472 - 1 * 115, 0.5, 0.5, depth);
        slotControls.settingsButton.addClickEvent(() => {
            console.log('settings click');
            var pu = scene.guiController.showPopUp(this.createSettingsPUHandler);
            scene.soundController.playClip('button_click')
        }, this);
        slotControls.settingsButton.button.setVisible(false);
        slotControls.rulesButton = addButton('button_rules', 'button_rules_hover', false, -815, 472 - 2 * 115, 0.5, 0.5, depth);
        slotControls.rulesButton.addClickEvent(() => {
            var pu = scene.guiController.showPopUp(this.createInfoPUHandler);
            scene.soundController.playClip('button_click')
        }, this);
        slotControls.rulesButton.button.setVisible(false);
        slotControls.slotInfoButton = addButton('button_info', 'button_info_hover', false, -815, 472 - 3 * 115, 0.5, 0.5, depth);
        slotControls.slotInfoButton.addClickEvent(() => {
            console.log('info click');
            var pu = scene.guiController.showPopUp(this.createAboutPUHandler);
            scene.soundController.playClip('button_click')
        }, this);
        slotControls.slotInfoButton.button.setVisible(false);
        slotControls.totalBetMinusButton = addButton('button_minus', 'button_minus_hover', false, -340 - 78, 468, 0.5, 0.5, depth);
        slotControls.totalBetMinusButton.addClickEvent(slotControls.lineBetMinus_Click, slotControls);
        slotControls.totalBetPlusButton = addButton('button_plus', 'button_plus_hover', false, -340 + 80, 468, 0.5, 0.5, depth);
        
        slotControls.addCoins = addButton('button_plus', 'button_plus_hover', false, +360 + 80, 468, 0.5, 0.5, depth);
        slotControls.addCoins.addClickEvent(() => {
            //修改
            scene.slotPlayer.coins = scene.slotPlayer.coins + 1000;
            slotControlsTmp.creditSumText.text = scene.slotPlayer.coins;

        }, this);
        
        slotControls.totalBetPlusButton.addClickEvent(slotControls.lineBetPlus_Click, slotControls);
        slotControls.linesText = scene.add.bitmapText(scene.centerX - 580, scene.centerY + 405, 'gameFont_2', 'Lines', 56, 1).setOrigin(0.5).setDepth(depth);
        slotControls.linesCountText = scene.add.bitmapText(scene.centerX - 580, scene.centerY + 467, 'gameFont_1', slotControls.selectedLinesCount, 72, 1).setOrigin(0.5).setDepth(depth);
        slotControls.lineBetText = scene.add.bitmapText(scene.centerX - 460, scene.centerY + 407, 'gameFont_2', 'Line Bet', 56, 1).setOrigin(0.5).setDepth(depth);
        slotControls.lineBetText.setVisible(false);
        slotControls.lineBetAmountText = scene.add.bitmapText(scene.centerX - 460, scene.centerY + 469, 'gameFont_1', slotControls.lineBet, 62, 1).setOrigin(0.5).setDepth(depth);
        slotControls.lineBetAmountText.setVisible(false);
        slotControls.totalBetText = scene.add.bitmapText(scene.centerX - 340, scene.centerY + 405, 'gameFont_2', 'Total Bet', 56, 1).setOrigin(0.5).setDepth(depth);
        slotControls.totalBetSumText = scene.add.bitmapText(scene.centerX - 340, scene.centerY + 467, 'gameFont_1', slotControls.getTotalBet(), 72, 1).setOrigin(0.5).setDepth(depth);
        slotControls.creditText = scene.add.bitmapText(scene.centerX + 340, scene.centerY + 405, 'gameFont_2', 'Balance', 56, 1).setOrigin(0.5).setDepth(depth);
        slotControls.creditSumText = scene.add.bitmapText(scene.centerX + 340, scene.centerY + 467, 'gameFont_1', '' + scene.slotPlayer.coins, 72, 1).setOrigin(0.5).setDepth(depth);
        slotControls.winText = scene.add.bitmapText(scene.centerX + 580, scene.centerY + 405, 'gameFont_2', 'Win', 56, 1).setOrigin(0.5).setDepth(depth);
        slotControls.winAmountText = scene.add.bitmapText(scene.centerX + 580, scene.centerY + 467, 'gameFont_1', '0', 72, 1).setOrigin(0.5).setDepth(depth);
        slotControls.jackpotText = scene.add.bitmapText(scene.centerX - 0, scene.centerY - 590, 'gameFont_0', 'Jackpot', 47, 1).setOrigin(0.5).setDepth(depth);
        slotControls.jackpotText.setVisible(false);
        slotControls.jackpotAmountText = scene.add.bitmapText(scene.centerX + 0, scene.centerY - 458, 'gameFont_3', '0', 72, 1).setOrigin(0.5).setDepth(depth + 1);
        slotControls.jackpotAmountText.setVisible(true);
        slotControls.spinText = scene.add.bitmapText(scene.centerX - 0, scene.centerY + 445, 'gameFont_3', slotControls.spinTextString, 72, 1).setOrigin(0.5).setDepth(depth);
        
        
        
        slotControls.helpText = scene.add.bitmapText(scene.centerX - 810, scene.centerY + 470, 'gameFont_1', slotControls.helpTextString, 57, 1).setOrigin(0.5).setDepth(depth);
        
        slotControls.infoText = scene.add.bitmapText(scene.centerX, scene.centerY + 400 + 200, 'gameFont_2', 'info', 30, 1).setOrigin(0.5).setDepth(depth);
        slotControls.infoText.setVisible(false);
        slotControls.freeSpinCountText = scene.add.bitmapText(scene.centerX, scene.centerY + 400 + 200, 'gameFont_3', '99', 102, 1).setOrigin(0.5).setDepth(depth);
        slotControls.freeSpinCountText.setVisible(false)
    },
    createInfoPUHandler: function(popup) {
        function createSymbolPlate5x(popup, parentContainer, symbSpriteName, posX, posY, price3x, price4x, price5x) {
            let symbContainer = popup.scene.add.container(posX, posY);
            parentContainer.add(symbContainer);
            let symbIcon = popup.scene.add.sprite(-100, 0, symbSpriteName).setOrigin(0.5).setScale(0.8);
            symbContainer.add(symbIcon);
            let textXPos = 30;
            let text3x = popup.scene.add.bitmapText(textXPos + 15, 67, 'gameFont_2', '3X', 56, 1).setOrigin(0, 0.5);
            symbContainer.add(text3x);
            let text3x1 = popup.scene.add.bitmapText(textXPos + 70, 67, 'gameFont_2', '- ' + price3x, 56, 1).setOrigin(0, 0.5);
            symbContainer.add(text3x1);
            let text4x = popup.scene.add.bitmapText(textXPos + 15, 20, 'gameFont_2', '4X', 56, 1).setOrigin(0, 0.5);
            symbContainer.add(text4x);
            let text4x1 = popup.scene.add.bitmapText(textXPos + 70, 20, 'gameFont_2', '- ' + price4x, 56, 1).setOrigin(0, 0.5);
            symbContainer.add(text4x1);
            let text5x = popup.scene.add.bitmapText(textXPos + 15, -27, 'gameFont_2', '5X', 56, 1).setOrigin(0, 0.5);
            symbContainer.add(text5x);
            let text5x1 = popup.scene.add.bitmapText(textXPos + 70, -27, 'gameFont_2', '- ' + price5x, 56, 1).setOrigin(0, 0.5);
            symbContainer.add(text5x1)
        };

        function createSpecSymbolPlate(popup, parentContainer, symbSpriteName, posX, posY, info) {
            let symbContainer = popup.scene.add.container(posX, posY);
            parentContainer.add(symbContainer);
            let symbIcon = popup.scene.add.sprite(0, 0, symbSpriteName).setOrigin(0.5, 0.5).setScale(0.8);
            symbContainer.add(symbIcon);
            let textInfo = popup.scene.add.bitmapText(135, 0, 'gameFont_1', info, 56, 0).setOrigin(0, 0.5);
            symbContainer.add(textInfo)
        };

        function refreshInfoPu(containers, selectors, index) {
            for (let i = 0; i < containers.length; i++) {
                containers[i].visible = (index === i);
                if (popup.scene.textures.exists('navi_dot_active') && popup.scene.textures.exists('navi_dot')) {
                    selectors[i].setTexture((index === i) ? 'navi_dot_active' : 'navi_dot')
                }
            }
        };
        let index = 0;
        let containers = [];
        let selectors = [];
        let offsetY = 0;
        let backGround = popup.scene.add.sprite(0, 0 + offsetY, 'white_bkg').setOrigin(0.5).setScale(2000);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(-2, -35 + offsetY, 'info_panel').setOrigin(0.5);
        popup.add(panel);
        popup.addButton('exitButton', 'exit_button', 'exit_button_hover', false, 582, -340 + offsetY);
        popup.addButton('nextButton', 'next_button', 'next_button_hover', false, 62, 455 + offsetY);
        popup.addButton('prevButton', 'prev_button', 'prev_button_hover', false, -62, 455 + offsetY);
        popup['exitButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['nextButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['prevButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['exitButton'].clickEvent.add(() => {
            popup.scene.guiController.closePopUp(popup)
        });
        popup['nextButton'].clickEvent.add(() => {
            if (index < containers.length - 1) index++;
            else index = 0;
            refreshInfoPu(containers, selectors, index)
        }, this);
        popup['prevButton'].clickEvent.add(() => {
            if (index > 0) index--;
            else index = containers.length - 1;
            refreshInfoPu(containers, selectors, index)
        }, this);
        let linesContainer = popup.scene.add.container(0, 0 + offsetY);
        containers.push(linesContainer);
        popup.add(linesContainer);
        let linesTitle = popup.scene.add.bitmapText(0, -262, 'gameFont_2', 'PAY LINES', 72, 1).setOrigin(0.5).setLetterSpacing(-2.8);
        linesContainer.add(linesTitle);
        let linesTable = popup.scene.add.sprite(-3, 27, 'paylines_table').setOrigin(0.5);
        linesContainer.add(linesTable);
        let linesText = popup.scene.add.bitmapText(0, 298, 'gameFont_1', 'Bet lines win if the winning symbols are in succession from the leftmost reel to right', 56, 1).setOrigin(0.5).setLetterSpacing(0);
        linesContainer.add(linesText);
        let minorContainer = popup.scene.add.container(0, 0 + offsetY);
        containers.push(minorContainer);
        popup.add(minorContainer);
        let minorTitle = popup.scene.add.bitmapText(0, -262, 'gameFont_2', 'MINOR SYMBOLS', 72, 1).setOrigin(0.5).setLetterSpacing(-2.8);
        minorContainer.add(minorTitle);
        let row1Y = -120;
        let row2Y = row1Y + 265;
        let col1X = -220;
        let colDist = 445;
        let col2X = col1X + colDist;
        let col3X = col2X + colDist;
        createSymbolPlate5x(popup, minorContainer, 'BlueBottle', col1X, row1Y, 1, 2, 3);
        createSymbolPlate5x(popup, minorContainer, 'GreenBottle', col2X, row1Y, 1, 3, 5);
        createSymbolPlate5x(popup, minorContainer, 'MargenteBottle', col1X, row2Y, 2, 3, 6);
        createSymbolPlate5x(popup, minorContainer, 'VioletBottle', col2X, row2Y, 2, 3, 7);
        minorContainer.visible = false;
        let majorContainer = popup.scene.add.container(0, 0 + offsetY);
        containers.push(majorContainer);
        popup.add(majorContainer);
        let majorTitle = popup.scene.add.bitmapText(0, -262, 'gameFont_2', 'MAJOR SYMBOLS', 72, 1).setOrigin(0.5).setLetterSpacing(-2.8);
        majorContainer.add(majorTitle);
        createSymbolPlate5x(popup, majorContainer, 'Candles', col1X, row1Y, 11, 13, 17);
        createSymbolPlate5x(popup, majorContainer, 'Broom', col2X, row1Y, 11, 13, 19);
        createSymbolPlate5x(popup, majorContainer, 'Scroll', col1X, row2Y, 11, 14, 20);
        createSymbolPlate5x(popup, majorContainer, 'Hat', col2X, row2Y, 11, 15, 25);
        majorContainer.visible = false;
        let specialContainer = popup.scene.add.container(0, 0 + offsetY);
        containers.push(specialContainer);
        popup.add(specialContainer);
        let specialTitle = popup.scene.add.bitmapText(0, -262, 'gameFont_2', 'SPECIAL SYMBOLS', 72, 1).setOrigin(0.5).setLetterSpacing(-2.8);
        specialContainer.add(specialTitle);
        createSpecSymbolPlate(popup, specialContainer, 'Wild', -440, -100, 'Wild can be used with any symbols on the reels to create \nwinning combinations (exclude first reel). \n' + 'Any  7  Wild symbols scattered on the screen = Jackpot Win.');
        createSpecSymbolPlate(popup, specialContainer, 'Scatter', -440, 170, 'Any 5 scatter  on the screen  give the player 5 free spins.\n' + 'Any 4 scatter  on the screen  give the player 2 free spins.\n' + 'Any 3 scatter  on the screen  give the player 1 free spins.');
        specialContainer.visible = false;
        let rulesContainer = popup.scene.add.container(0, 0 + offsetY);
        containers.push(rulesContainer);
        popup.add(rulesContainer);
        let rulesTitle = popup.scene.add.bitmapText(0, -262, 'gameFont_2', 'RULES', 72, 1).setOrigin(0.5).setLetterSpacing(-2.8);
        rulesContainer.add(rulesTitle);
        let aboutTitle = popup.scene.add.bitmapText(-575, -160, 'gameFont_2', 'ABOUT THE GAME', 56, 0).setOrigin(0, 0.5);
        rulesContainer.add(aboutTitle);
        let lineSpacing = 40;
        let aboutText = popup.scene.add.bitmapText(-575, -130, 'gameFont_1', 'Witch  slot  is  a  pack  of  Slot Games with 5 reels and  20 paylines oriented from left to', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(aboutText);
        let aboutText1 = popup.scene.add.bitmapText(-575, -130 + 1 * lineSpacing, 'gameFont_1', 'right. The games have 8 regular symbols that win  if  three  or  more  are lined  up  in', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(aboutText1);
        let aboutText2 = popup.scene.add.bitmapText(-575, -130 + 2 * lineSpacing, 'gameFont_1', 'sequence on  a  payline, beginning  from  the leftmost  position. The  4  high pay symbols', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(aboutText2);
        let aboutText3 = popup.scene.add.bitmapText(-575, -130 + 3 * lineSpacing, 'gameFont_1', 'and the  5  low pay symbols.  The  slot  also  features  a  mini-game.', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(aboutText3);
        let howTitle = popup.scene.add.bitmapText(-575, 120, 'gameFont_2', 'How to play', 56, 0).setOrigin(0, 0.5);
        rulesContainer.add(howTitle);
        let howText = popup.scene.add.bitmapText(-575, 150, 'gameFont_1', '- Place your bet', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(howText);
        let howText1 = popup.scene.add.bitmapText(-575, 150 + 1 * lineSpacing, 'gameFont_1', '- Press the Spin button to start game', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(howText1);
        let howText2 = popup.scene.add.bitmapText(-575, 150 + 2 * lineSpacing, 'gameFont_1', '- You can also use Max Bet button to auto bet', 56, 0).setOrigin(0, 0).setLetterSpacing(-1);
        rulesContainer.add(howText2);
        refreshInfoPu(containers, selectors, index)
    },
    createAboutPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(0, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, 6 + yOffset, 'about_panel').setOrigin(0.5);
        popup.add(panel);
        let logo = popup.scene.add.sprite(0, -40 + yOffset, 'logo').setOrigin(0.5);
        popup.add(logo);
        popup.messageText = popup.scene.add.bitmapText(0, 118 + yOffset, 'gameFont_1', 'Need Help?', 56, 1).setOrigin(0.5);
        popup.add(popup.messageText);
        popup.addButton('supportButton', 'long_button', 'long_button_hover', false, 0, 200 + yOffset);
        popup.addButton('exitButton', 'exit_button', 'exit_button_hover', false, 160, -202 + yOffset);
        popup['supportButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['supportButton'].clickEvent.add(() => {
            window.open("http://www.mkeystudio.com")
        }, popup);
        popup['exitButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['exitButton'].clickEvent.add(() => {
            popup.scene.guiController.closePopUp(popup)
        });
        popup.supText = popup.scene.add.bitmapText(0, 197 + yOffset, 'gameFont_1', 'Support', 72, 1).setOrigin(0.5).setLetterSpacing(-2);
        popup.add(popup.supText)
    },
    createSettingsPUHandler: function(popup) {
        function refreshIcons(popup) {}
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(0, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, 4 + yOffset, 'settings_panel').setOrigin(0.5);
        popup.add(panel);
        popup.soundText = popup.scene.add.bitmapText(-85, -128 + yOffset, 'gameFont_1', 'Sounds', 56, 1).setOrigin(0.5);
        popup.add(popup.soundText);
        popup.musicText = popup.scene.add.bitmapText(85, -128 + yOffset, 'gameFont_1', 'Music', 56, 1).setOrigin(0.5);
        popup.musicText.setLetterSpacing(-1.5);
        popup.add(popup.musicText);
        popup.addButton('soundButton', 'button_on', 'button_off', true, -87, -42 + yOffset);
        popup.addButton('musicButton', 'button_on', 'button_off', true, 87, -42 + yOffset);
        popup['soundButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['soundButton'].clickEvent.add(() => {
            popup.scene.soundController.soundOn(!popup.scene.soundController._soundOn);
            refreshIcons(popup)
        }, popup);
        if (!popup.scene.soundController._soundOn) popup['soundButton'].setPressed();
        popup['musicButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['musicButton'].clickEvent.add(() => {
            popup.scene.soundController.musicOn(!popup.scene.soundController._musicOn);
            refreshIcons(popup)
        }, popup);
        if (!popup.scene.soundController._musicOn) popup['musicButton'].setPressed();
        popup.addButton('exitButton', 'exit_button', 'exit_button_hover', false, 190, -200 + yOffset);
       
        popup['exitButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['exitButton'].clickEvent.add(() => {
            popup.scene.guiController.closePopUp(popup)
        });
        popup.privacyText = popup.scene.add.bitmapText(0, 82 + yOffset, 'gameFont_1', 'Privacy Policy', 72, 1).setOrigin(0.5).setLetterSpacing(-1.3);
        popup.add(popup.privacyText);
        popup.termsText = popup.scene.add.bitmapText(0, 197 + yOffset, 'gameFont_1', 'Terms of Use', 72, 1).setOrigin(0.5).setLetterSpacing(-1.3);
        popup.add(popup.termsText);
        refreshIcons(popup)
    },
    createFreeGamesPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(0, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        backGround.setAlpha(0.7);
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, -100 + yOffset, 'freespin_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, -15 + yOffset, 'gameFont_2', '0', 72, 1).setOrigin(0.5);
        popup.add(popup.messageText);
        popup.addButton('okButton', 'long_button', 'long_button_hover', false, 0, 100 + yOffset);
        popup['okButton'].clickEvent.add(() => {
            popup.scene.soundController.playClip('button_click', false)
        }, popup);
        popup['okButton'].clickEvent.add(() => {
            popup.scene.guiController.closePopUp(popup)
        });
        popup.okText = popup.scene.add.bitmapText(0, 94 + yOffset, 'gameFont_1', 'Start', 72, 1).setOrigin(0.5);
        popup.add(popup.okText)
    },
    createFreeSpinsWinPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(-10, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        backGround.setAlpha(0.7);
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, -20 + yOffset, 'freespin_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, 80 + yOffset, 'gameFont_2', '0', 72, 1).setOrigin(0.5);
        popup.add(popup.messageText)
    },
    createBigWinPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(-10, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000).setAlpha(0.7);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, -0 + yOffset, 'bigwin_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, -0 + yOffset, 'gameFont_3', '0', 42, 1).setOrigin(0.5).setLetterSpacing(1.4);
        popup.add(popup.messageText)
    },
    createHugeWinPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(0, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000).setAlpha(0.7);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(1, 0 + yOffset, 'hugewin_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, 120 + yOffset, 'gameFont_3', '0', 72, 1).setOrigin(0.5).setLetterSpacing(1.4);
        popup.add(popup.messageText)
    },
    createMegaWinPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(0, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000).setAlpha(0.7);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, 0 + yOffset, 'megawin_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, 120 + yOffset, 'gameFont_2', '0', 72, 1).setOrigin(0.5).setLetterSpacing(1.4);
        popup.add(popup.messageText)
    },
    createJackpotWinPUHandler: function(popup) {
        let yOffset = 0;
        let backGround = popup.scene.add.sprite(0, 0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000).setAlpha(0.7);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, -0 + yOffset, 'jackpotwin_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, 120 + yOffset, 'gameFont_2', '0', 72, 1).setOrigin(0.5);
        popup.add(popup.messageText)
    },
    createEmptyPUHandler: function(popup) {
        let backGround = popup.scene.add.sprite(0, 0, 'gray_01').setOrigin(0.5).setScale(1000);
        backGround.setInteractive();
        popup.add(backGround)
    },
    createSmallMessagePUHandler: function(popup) {
        let yOffset = -0;
        let backGround = popup.scene.add.sprite(0, -0 + yOffset, 'white_bkg').setOrigin(0.5).setScale(2000).setAlpha(0.5);
        backGround.setInteractive();
        backGround.tint = 0x171716;
        popup.add(backGround);
        let panel = popup.scene.add.sprite(0, 0 + yOffset, 'small_message_panel').setOrigin(0.5);
        popup.add(panel);
        popup.messageText = popup.scene.add.bitmapText(0, -5 + yOffset, 'gameFont_1', 'Message', 56, 1).setOrigin(0.5);
        popup.add(popup.messageText)
    },
    blinkLanterns: function(scene) {
        let spot1 = scene.addSpriteLocPos('lantern_spot', -760, -300).setOrigin(0.5).setAlpha(0.5);
        let spot2 = scene.addSpriteLocPos('lantern_spot', 760, -300).setOrigin(0.5).setAlpha(0.5);
        scene.lanternTimeCoder1 = new TimeCoder(this, '0101111100110011111100000000000', 200, (on) => {
            spot1.setVisible(on)
        });
        scene.lanternTimeCoder2 = new TimeCoder(this, '0000000001100011111100011100011111100000', 200, (on) => {
            spot2.setVisible(on)
        });

        function update(time, delta) {
            scene.lanternTimeCoder1.update(delta);
            scene.lanternTimeCoder2.update(delta)
        }
        scene.updateEvent.add(update, this)
    },
    lastCreate: function(scene) {
        slotConfig.blinkLanterns(scene)
    },
}

class AnimatedCoinParticle extends Phaser.GameObjects.Particles.Particle {
    constructor(emitter) {
        super(emitter);

        this.t = 0;
        this.i = 0;
        this.framesCount = 6;
    }

    update(delta, step, processors) {
        var result = super.update(delta, step, processors);
        this.t += delta;

        if (this.t >= coinSpinAnim.msPerFrame) {
            this.i++;
            if (this.i > this.framesCount - 1) {
                this.i = 0;
            }
            this.frame = coinSpinAnim.frames[this.i].frame;
            this.t -= coinSpinAnim.msPerFrame;
        }
        return result;
    }
}

class ProgressSlider {
    constructor(scene, baseLocPosX, baseLocPosY, baseSprite, fillLocPosX, fillLocPosY, fillSprite, spotSprite, depth) {
        this.fillAmount = 0;
        this.scene = scene;
        this.fillLocPosX = fillLocPosX;
        this.fillLocPosY = fillLocPosY;
        this.baseSprite = scene.addSpriteLocPos(baseSprite, baseLocPosX, baseLocPosY);
        this.baseSprite.setDepth(depth);
        this.fillSprite = scene.addSpriteLocPos(fillSprite, fillLocPosX, fillLocPosY);
        this.fillSprite.setDepth(depth + 1);

        this.sizeX = this.fillSprite.width;
        this.sizeY = this.fillSprite.height;
        // console.log('mask sizeX: ' + sizeX  + ' ;mask sizeY: ' + sizeY);

        this.spotSprite = scene.addSpriteLocPos(spotSprite, fillLocPosX - this.sizeX / 2, fillLocPosY);
        this.spotSprite.setDepth(depth + 2);

        this.shapePosX = scene.centerX + fillLocPosX - this.sizeX / 2;
        this.shapePosY = scene.centerY + fillLocPosY + this.sizeY / 2;
        this.shape = scene.add.graphics();
        this.shape.fillStyle(0xffffff);
        this.shape.beginPath();
        this.shape.fillRect(this.shapePosX, this.shapePosY, this.sizeX, -this.sizeY);
        this.shape.depth = depth + 2;
        this.shape.setVisible(false);

        this.gMask = this.shape.createGeometryMask();
        this.fillSprite.setMask(this.gMask);

        this.setFillAmount(this.fillAmount);
    }

    setFillAmount(amount) {
        if (amount > 1) amount = 1;
        if (amount < 0) amount = 0;
        this.fillAmount = amount;
        var _sizeX = this.sizeX * amount;
        this.shape.clear();
        this.shape.fillRect(this.shapePosX, this.shapePosY, _sizeX, -this.sizeY);
        this.spotSprite.setPosition(this.shapePosX + _sizeX, this.scene.centerY + this.fillLocPosY);
        this.spotSprite.setVisible(this.fillAmount > 0);
    }
}
